rules_version = '2';
service cloud.firestore {
    match /databases/{database}/documents {
        // Auth utility functions
        function isAdmin() {
            return request.auth.token.role == "admin"
        }
        function isOrga() {
            return request.auth.token.role == "orga"
        }
        function isDriver() {
            return request.auth.token.role == "driver"
        }
        function isGuest() {
            return request.auth.token.role == "guest"
        }

        match /orga/{document} {
            allow read: if isAdmin()
            allow create:
                if isAdmin()
                && request.resource.data.keys().hasOnly(['name', 'email'])
                && request.resource.data.name is string
                && request.resource.data.email is string
            allow delete: if isAdmin()
        }
        match /loginRequests/{documentId} {
                    allow create: if true
                        && request.resource.data.keys().hasOnly(['email', 'host'])
                        && request.resource.data.email is string
                        && request.resource.data.host is string
                    allow get: if true
                }
  }
}